<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íƒœì–‘ ê´€ì¸¡ ì‹¤í—˜ ë„êµ¬</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        /* ìº”ë²„ìŠ¤ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        canvas {
            display: block;
            background-color: #e0f2fe; /* Light blue sky background */
        }
    </style>
</head>
<body class="p-4 sm:p-8 flex items-center justify-center min-h-screen">
    <div class="bg-white p-6 sm:p-10 rounded-3xl shadow-xl w-full max-w-4xl">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-2">íƒœì–‘ ê´€ì¸¡ ì‹¤í—˜ ê¸°ë¡ê¸° â˜€ï¸</h1>
        <p class="text-center text-gray-500 mb-8 text-sm sm:text-base">
            í•˜ë£¨ ë™ì•ˆ íƒœì–‘ ê³ ë„, ê·¸ë¦¼ì ê¸¸ì´, ê¸°ì˜¨ì„ ì¸¡ì •í•˜ì—¬ ê¸°ë¡í•˜ê³  ê·¸ë˜í”„ì™€ ê·¸ë¦¼ìœ¼ë¡œ í™•ì¸í•´ ë³´ì„¸ìš”!
        </p>

        <!-- Data Input Section -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <input type="text" id="time-input" placeholder="ì‹œê°„ (ì˜ˆ: 10:00)" class="p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors">
            <input type="number" id="altitude-input" placeholder="íƒœì–‘ ê³ ë„ (Â°)" class="p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors">
            <input type="number" id="shadow-input" placeholder="ê·¸ë¦¼ì ê¸¸ì´ (cm)" class="p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors">
            <input type="number" id="temp-input" placeholder="ê¸°ì˜¨ (Â°C)" class="p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors">
        </div>
        <div class="flex flex-col sm:flex-row gap-4 mb-8">
            <button id="add-data-btn" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-xl shadow-md transition-colors transform hover:scale-105">
                ë°ì´í„° ì¶”ê°€
            </button>
            <button id="draw-graph-btn" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-xl shadow-md transition-colors transform hover:scale-105">
                ê·¸ë˜í”„ ë° ê·¸ë¦¼ ê·¸ë¦¬ê¸°
            </button>
            <button id="clear-data-btn" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-xl shadow-md transition-colors transform hover:scale-105">
                ë°ì´í„° ì´ˆê¸°í™”
            </button>
        </div>

        <!-- Data Table Section -->
        <div class="overflow-x-auto mb-8">
            <table class="min-w-full bg-white rounded-xl shadow-sm">
                <thead>
                    <tr class="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left">ì‹œê°„</th>
                        <th class="py-3 px-6 text-left">íƒœì–‘ ê³ ë„ (Â°)</th>
                        <th class="py-3 px-6 text-left">ê·¸ë¦¼ì ê¸¸ì´ (cm)</th>
                        <th class="py-3 px-6 text-left">ê¸°ì˜¨ (Â°C)</th>
                    </tr>
                </thead>
                <tbody id="data-table-body" class="text-gray-600 text-sm font-light">
                    <!-- Data rows will be inserted here -->
                </tbody>
            </table>
        </div>
        
        <!-- Sun Visualization Section -->
        <div class="mt-8">
            <h2 class="text-xl sm:text-2xl font-bold text-center text-gray-700 mb-4">íƒœì–‘ ìœ„ì¹˜ ë° ê¸°ì˜¨ ë³€í™” ê·¸ë¦¼ ğŸŒ¡ï¸</h2>
            <div class="bg-gray-50 p-4 rounded-xl shadow-inner border border-gray-200">
                <canvas id="sun-visualization-canvas" width="800" height="400" class="w-full h-auto"></canvas>
            </div>
        </div>
        
        <!-- Graph Section -->
        <div class="mt-8">
            <h2 class="text-xl sm:text-2xl font-bold text-center text-gray-700 mb-4">ì‹œê°„ì— ë”°ë¥¸ ë°ì´í„° ë³€í™” ê·¸ë˜í”„ ğŸ“ˆ</h2>
            <div class="bg-gray-50 p-4 rounded-xl shadow-inner border border-gray-200">
                <canvas id="correlation-chart" width="800" height="400" class="w-full h-auto"></canvas>
            </div>
        </div>
    </div>

    <!-- Chart.js library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        window.onload = function() {
            // í•„ìš”í•œ HTML ìš”ì†Œë“¤ì„ ëª¨ë‘ ê°€ì ¸ì˜µë‹ˆë‹¤.
            const timeInput = document.getElementById('time-input');
            const altitudeInput = document.getElementById('altitude-input');
            const shadowInput = document.getElementById('shadow-input');
            const tempInput = document.getElementById('temp-input');
            const addDataBtn = document.getElementById('add-data-btn');
            const drawGraphBtn = document.getElementById('draw-graph-btn');
            const clearDataBtn = document.getElementById('clear-data-btn');
            const dataTableBody = document.getElementById('data-table-body');
            const chartCanvas = document.getElementById('correlation-chart');
            const sunVizCanvas = document.getElementById('sun-visualization-canvas');

            let experimentData = [];
            let myChart = null;
            let animationFrameId = null; // ì• ë‹ˆë©”ì´ì…˜ í”„ë ˆì„ IDë¥¼ ì €ì¥í•  ë³€ìˆ˜

            // ë°ì´í„° í‘œë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
            function updateTable() {
                dataTableBody.innerHTML = '';
                experimentData.forEach(data => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="py-3 px-6 whitespace-nowrap">${data.time}</td>
                        <td class="py-3 px-6">${data.altitude}</td>
                        <td class="py-3 px-6">${data.shadow}</td>
                        <td class="py-3 px-6">${data.temp}</td>
                    `;
                    row.classList.add('border-b', 'border-gray-200', 'hover:bg-gray-50');
                    dataTableBody.appendChild(row);
                });
            }

            // ìº”ë²„ìŠ¤ì— ì •ì ì¸ ë°°ê²½ì„ ê·¸ë¦¬ëŠ” í•¨ìˆ˜
            function drawStaticBackground(ctx, canvasWidth, canvasHeight) {
                // ë°°ê²½ ê·¸ë¼ë°ì´ì…˜ (í•˜ëŠ˜)
                const skyGradient = ctx.createLinearGradient(0, 0, 0, canvasHeight);
                skyGradient.addColorStop(0, '#87ceeb'); // Top sky color
                skyGradient.addColorStop(1, '#e0f2fe'); // Bottom sky color
                ctx.fillStyle = skyGradient;
                ctx.fillRect(0, 0, canvasWidth, canvasHeight);

                // ì§€ë©´ ê·¸ë¦¬ê¸°
                ctx.fillStyle = '#10b981'; // Green-500
                ctx.fillRect(0, canvasHeight * 0.8, canvasWidth, canvasHeight * 0.2);
            }

            // íƒœì–‘ ìœ„ì¹˜ ë° ê¸°ì˜¨ ë³€í™” ì• ë‹ˆë©”ì´ì…˜ì„ ê´€ë¦¬í•˜ëŠ” í•¨ìˆ˜
            function drawSunVisualization() {
                const ctx = sunVizCanvas.getContext('2d');
                const canvasWidth = sunVizCanvas.width;
                const canvasHeight = sunVizCanvas.height;

                // ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘ ì „ì— ìº”ë²„ìŠ¤ ì´ˆê¸°í™” ë° ë°°ê²½ ê·¸ë¦¬ê¸°
                ctx.clearRect(0, 0, canvasWidth, canvasHeight);
                drawStaticBackground(ctx, canvasWidth, canvasHeight);

                // ë°ì´í„°ê°€ 2ê°œ ë¯¸ë§Œì´ë©´ ì• ë‹ˆë©”ì´ì…˜ì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                if (experimentData.length < 2) {
                    return;
                }

                // ë°ì´í„° ì •ë ¬ (ì‹œê°„ ìˆœì„œëŒ€ë¡œ)
                experimentData.sort((a, b) => new Date(`2000/01/01 ${a.time}`) - new Date(`2000/01/01 ${b.time}`));

                // ë°ì´í„°ì˜ ì‹œê°„, ê³ ë„, ê¸°ì˜¨ ë²”ìœ„ ê³„ì‚°
                const timesInMs = experimentData.map(d => new Date(`2000/01/01 ${d.time}`).getTime());
                const altitudes = experimentData.map(d => d.altitude);
                const temps = experimentData.map(d => d.temp);

                const minTime = timesInMs[0];
                const maxTime = timesInMs[timesInMs.length - 1];
                const totalTimeRange = maxTime - minTime;
                
                const minTemp = Math.min(...temps);
                const maxTemp = Math.max(...temps);
                const tempRange = maxTemp - minTemp;

                // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„
                const animationDuration = 5000; // 5ì´ˆ ë™ì•ˆ ì• ë‹ˆë©”ì´ì…˜
                let startTime = null;

                function animate(timestamp) {
                    if (!startTime) startTime = timestamp;
                    const elapsedTime = timestamp - startTime;
                    const progress = Math.min(elapsedTime / animationDuration, 1);

                    // ìº”ë²„ìŠ¤ ì´ˆê¸°í™” ë° ë°°ê²½ ê·¸ë¦¬ê¸°
                    ctx.clearRect(0, 0, canvasWidth, canvasHeight);
                    drawStaticBackground(ctx, canvasWidth, canvasHeight);

                    // í˜„ì¬ ì‹œê°„/ê³ ë„/ê¸°ì˜¨ ê°’ ê³„ì‚° (ë³´ê°„)
                    let currentAltitude, currentTemp, currentTime;
                    if (progress === 1) { // ì• ë‹ˆë©”ì´ì…˜ì´ ëë‚¬ì„ ë•Œ ë§ˆì§€ë§‰ ë°ì´í„° í¬ì¸íŠ¸ ì‚¬ìš©
                        currentAltitude = altitudes[altitudes.length - 1];
                        currentTemp = temps[temps.length - 1];
                        currentTime = experimentData[experimentData.length - 1].time;
                    } else {
                        // í˜„ì¬ ì§„í–‰ ìƒí™©ì— ë§ëŠ” ë°ì´í„° ì¸ë±ìŠ¤ ì°¾ê¸°
                        const currentGlobalTime = minTime + (totalTimeRange * progress);
                        
                        let currentIndex = 0;
                        for (let i = 0; i < timesInMs.length - 1; i++) {
                            if (currentGlobalTime >= timesInMs[i] && currentGlobalTime <= timesInMs[i+1]) {
                                currentIndex = i;
                                break;
                            }
                        }

                        // ë‘ ë°ì´í„° í¬ì¸íŠ¸ ì‚¬ì´ì˜ ë³´ê°„
                        const startData = experimentData[currentIndex];
                        const endData = experimentData[currentIndex + 1];
                        const startMs = timesInMs[currentIndex];
                        const endMs = timesInMs[currentIndex + 1];
                        const localProgress = (currentGlobalTime - startMs) / (endMs - startMs);

                        currentAltitude = startData.altitude + (endData.altitude - startData.altitude) * localProgress;
                        currentTemp = startData.temp + (endData.temp - startData.temp) * localProgress;
                        
                        // ì‹œê°„ í…ìŠ¤íŠ¸ë„ ë³´ê°„í•˜ì—¬ ìì—°ìŠ¤ëŸ½ê²Œ ë³´ì´ë„ë¡
                        const startHour = parseInt(startData.time.split(':')[0], 10);
                        const startMinute = parseInt(startData.time.split(':')[1], 10);
                        const endHour = parseInt(endData.time.split(':')[0], 10);
                        const endMinute = parseInt(endData.time.split(':')[1], 10);

                        const totalStartMinutes = startHour * 60 + startMinute;
                        const totalEndMinutes = endHour * 60 + endMinute;
                        const totalCurrentMinutes = totalStartMinutes + (totalEndMinutes - totalStartMinutes) * localProgress;

                        const currentHour = Math.floor(totalCurrentMinutes / 60);
                        const currentMinute = Math.round(totalCurrentMinutes % 60);
                        currentTime = `${String(currentHour).padStart(2, '0')}:${String(currentMinute).padStart(2, '0')}`;
                    }
                    
                    // íƒœì–‘ì˜ X, Y ì¢Œí‘œ ê³„ì‚°
                    const x = canvasWidth * progress;
                    const y = canvasHeight * 0.8 - (currentAltitude / 90) * (canvasHeight * 0.7);

                    // íƒœì–‘ ê·¸ë¦¬ê¸°
                    ctx.beginPath();
                    ctx.arc(x, y, 20, 0, Math.PI * 2, false);
                    ctx.fillStyle = '#fde047'; // Yellow-300
                    ctx.fill();

                    // ê¸°ì˜¨ì„ ë‚˜íƒ€ë‚´ëŠ” ì˜¨ë„ê³„ ê·¸ë¦¬ê¸°
                    const thermometerHeight = 80;
                    const thermometerWidth = 15;
                    const thermometerX = x + 30;
                    const thermometerY = y - 40;
                    
                    // ì˜¨ë„ê³„ ëª¸í†µ (ë¹ˆ ë¶€ë¶„)
                    ctx.beginPath();
                    ctx.rect(thermometerX, thermometerY, thermometerWidth, thermometerHeight);
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                    ctx.fill();
                    ctx.strokeStyle = '#6b7280';
                    ctx.stroke();

                    // ì˜¨ë„ê³„ ëˆˆê¸ˆ (ì±„ì›Œì§„ ë¶€ë¶„)
                    const tempFillHeight = tempRange > 0 ? ((currentTemp - minTemp) / tempRange) * thermometerHeight : 0;
                    ctx.beginPath();
                    ctx.rect(thermometerX, thermometerY + thermometerHeight - tempFillHeight, thermometerWidth, tempFillHeight);
                    ctx.fillStyle = '#dc2626'; // Red-600
                    ctx.fill();

                    // ê¸°ì˜¨ í…ìŠ¤íŠ¸
                    ctx.fillStyle = '#374151'; // Gray-700
                    ctx.font = '14px Inter';
                    ctx.textAlign = 'center';
                    ctx.fillText(`${currentTemp.toFixed(1)}Â°C`, thermometerX + thermometerWidth / 2, thermometerY - 5);
                    
                    // ì‹œê°„ í…ìŠ¤íŠ¸
                    ctx.fillText(currentTime, x, canvasHeight * 0.85);

                    if (progress < 1) {
                        animationFrameId = requestAnimationFrame(animate);
                    } else {
                        // ì• ë‹ˆë©”ì´ì…˜ ì¢…ë£Œ í›„, ëª¨ë“  ë°ì´í„° í¬ì¸íŠ¸ì˜ íƒœì–‘ê³¼ ì˜¨ë„ê³„ë¥¼ ê·¸ë¦½ë‹ˆë‹¤.
                        drawAllStaticDataPoints();
                    }
                }

                // ëª¨ë“  ë°ì´í„° í¬ì¸íŠ¸ì˜ íƒœì–‘ê³¼ ì˜¨ë„ê³„ë¥¼ ì •ì ìœ¼ë¡œ ê·¸ë¦¬ëŠ” í•¨ìˆ˜
                function drawAllStaticDataPoints() {
                    experimentData.forEach(data => {
                        const timeInMs = new Date(`2000/01/01 ${data.time}`).getTime();
                        
                        const x = canvasWidth * ((timeInMs - minTime) / (maxTime - minTime));
                        const y = canvasHeight * 0.8 - (data.altitude / 90) * (canvasHeight * 0.7);
                        
                        ctx.beginPath();
                        ctx.arc(x, y, 20, 0, Math.PI * 2, false);
                        ctx.fillStyle = '#fde047';
                        ctx.fill();

                        const thermometerHeight = 80;
                        const thermometerWidth = 15;
                        const thermometerX = x + 30;
                        const thermometerY = y - 40;
                        
                        ctx.beginPath();
                        ctx.rect(thermometerX, thermometerY, thermometerWidth, thermometerHeight);
                        ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                        ctx.fill();
                        ctx.strokeStyle = '#6b7280';
                        ctx.stroke();
                        
                        const tempFillHeight = tempRange > 0 ? ((data.temp - minTemp) / tempRange) * thermometerHeight : 0;
                        ctx.beginPath();
                        ctx.rect(thermometerX, thermometerY + thermometerHeight - tempFillHeight, thermometerWidth, tempFillHeight);
                        ctx.fillStyle = '#dc2626';
                        ctx.fill();
                        
                        ctx.fillStyle = '#374151';
                        ctx.font = '14px Inter';
                        ctx.textAlign = 'center';
                        ctx.fillText(`${data.temp}Â°C`, thermometerX + thermometerWidth / 2, thermometerY - 5);
                        
                        ctx.fillText(data.time, x, canvasHeight * 0.85);
                    });
                }
                
                // ê¸°ì¡´ ì• ë‹ˆë©”ì´ì…˜ì´ ìˆë‹¤ë©´ ì¤‘ì§€í•©ë‹ˆë‹¤.
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                }
                // ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
                animationFrameId = requestAnimationFrame(animate);
            }

            // "ë°ì´í„° ì¶”ê°€" ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            addDataBtn.addEventListener('click', () => {
                const time = timeInput.value.trim();
                const altitude = parseFloat(altitudeInput.value);
                const shadow = parseFloat(shadowInput.value);
                const temp = parseFloat(tempInput.value);

                // ì…ë ¥ê°’ ìœ íš¨ì„± ê²€ì‚¬
                if (!time || isNaN(altitude) || isNaN(shadow) || isNaN(temp)) {
                    // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.
                    alert('ëª¨ë“  ê°’ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                // ë°°ì—´ì— ìƒˆë¡œìš´ ë°ì´í„° ì¶”ê°€
                experimentData.push({ time, altitude, shadow, temp });
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                timeInput.value = '';
                altitudeInput.value = '';
                shadowInput.value = '';
                tempInput.value = '';

                // ë°ì´í„° í‘œ ì—…ë°ì´íŠ¸
                updateTable();
            });

            // "ê·¸ë˜í”„ ë° ê·¸ë¦¼ ê·¸ë¦¬ê¸°" ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            drawGraphBtn.addEventListener('click', () => {
                // ì´ì „ ê·¸ë˜í”„ê°€ ìˆìœ¼ë©´ íŒŒê´´í•©ë‹ˆë‹¤.
                if (myChart) {
                    myChart.destroy();
                }

                if (experimentData.length < 2) {
                    alert('ê·¸ë˜í”„ë¥¼ ê·¸ë¦¬ë ¤ë©´ 2ê°œ ì´ìƒì˜ ë°ì´í„°ê°€ í•„ìš”í•©ë‹ˆë‹¤.');
                    return;
                }

                // ë°ì´í„°ë¥¼ ê·¸ë˜í”„ í˜•ì‹ì— ë§ê²Œ ë³€í™˜
                const labels = experimentData.map(data => data.time);
                const altitudes = experimentData.map(data => data.altitude);
                const shadows = experimentData.map(data => data.shadow);
                const temps = experimentData.map(data => data.temp);

                // Chart.js ì„¤ì •
                const data = {
                    labels: labels,
                    datasets: [
                        {
                            label: 'íƒœì–‘ ê³ ë„',
                            data: altitudes,
                            borderColor: '#4338ca', // indigo-700
                            backgroundColor: 'rgba(67, 56, 202, 0.2)',
                            fill: false,
                            tension: 0.4
                        },
                        {
                            label: 'ê·¸ë¦¼ì ê¸¸ì´',
                            data: shadows,
                            borderColor: '#10b981', // green-500
                            backgroundColor: 'rgba(16, 185, 129, 0.2)',
                            fill: false,
                            tension: 0.4
                        },
                        {
                            label: 'ê¸°ì˜¨',
                            data: temps,
                            borderColor: '#ef4444', // red-500
                            backgroundColor: 'rgba(239, 68, 68, 0.2)',
                            fill: false,
                            tension: 0.4
                        }
                    ]
                };

                const config = {
                    type: 'line',
                    data: data,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'ì‹œê°„ì— ë”°ë¥¸ íƒœì–‘ ê³ ë„, ê·¸ë¦¼ì ê¸¸ì´, ê¸°ì˜¨ ë³€í™”',
                                font: {
                                    size: 16
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'ì‹œê°„'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'ê°’'
                                }
                            }
                        }
                    }
                };

                // ìƒˆë¡œìš´ ì°¨íŠ¸ ìƒì„±
                myChart = new Chart(chartCanvas, config);
                
                // íƒœì–‘ ìœ„ì¹˜ ê·¸ë¦¼ ê·¸ë¦¬ê¸° í•¨ìˆ˜ í˜¸ì¶œ
                drawSunVisualization();
            });

            // "ë°ì´í„° ì´ˆê¸°í™”" ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            clearDataBtn.addEventListener('click', () => {
                experimentData = [];
                updateTable();
                
                // ê·¸ë˜í”„ì™€ ê·¸ë¦¼ ëª¨ë‘ ì´ˆê¸°í™”
                if (myChart) {
                    myChart.destroy();
                    myChart = null;
                }
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }
                const sunVizCtx = sunVizCanvas.getContext('2d');
                sunVizCtx.clearRect(0, 0, sunVizCanvas.width, sunVizCanvas.height);
            });
        };
    </script>
</body>
</html>
